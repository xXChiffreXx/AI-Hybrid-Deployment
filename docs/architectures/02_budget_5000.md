# Architecture Option B: $5,000 Machine Budget

## Goal

Balance long-term local throughput with moderate upfront cost, while reducing cloud spillover for routine Track A generation workloads.

## Target Infrastructure Profile

- 1 shared research node
- 10Gb Ethernet
- 16-24 CPU cores
- 128 GB RAM target
- 4 TB NVMe SSD
- GPU or unified-memory profile suitable for larger quantized models and higher concurrency
- SSH access for small team (3-8 users)

OS remains flexible because local serving interface is standardized via `llama-server`.

## Logical Architecture

- `gateway` with route classes (`local-default`, `local-long`, `cloud-hard`)
- `llama-server` local endpoint (single high-capacity instance or two tiered instances)
- `redis` cache and queue state
- `qdrant` vector retrieval by sector
- `kb-writer` to canonical `SQLite + Parquet`
- `obsidian-projector` for generated vault indexes

## Deployment Pattern

- Single-node stack with stronger local inference capacity
- Cloud primarily reserved for hard reasoning and temporary peaks

## Capacity Assumption

- Effective local capacity target: $\mu = 180$ tokens/sec
- Per-source token load: $725{,}000$

Theoretical local-only source throughput:

$$

\text{sources/day} = \frac{180 \cdot 86400}{725000} \approx 21.46

$$

## Cloud Cost Model (Instantiated)

Using the shared model in `00_cloud_cost_model.md`:

- Hard-task cloud fraction: $r_h = 0.12$
- Baseline peak demand: $145.45$ tokens/sec
- Stress peak demand: $261.81$ tokens/sec

Overflow fractions:

$$

r_{over,base}=\max\left(0,\frac{145.45-180}{145.45}\right)=0

$$

$$

r_{over,stress}=\max\left(0,\frac{261.81-180}{261.81}\right)=0.3125

$$

Monthly cloud cost:

$$

C_{month}=S\left(r_hc_h+(1-r_h)r_{over}c_e\right)

$$

with $c_e=0.33925$, $c_h=1.69625$.

Baseline (`S=130`):

$$

C_{base}=130\left(0.12\cdot1.69625+0.88\cdot0\cdot0.33925\right)=\$26.46/month

$$

Stress (`S=234`):

$$

C_{stress}=234\left(0.12\cdot1.69625+0.88\cdot0.3125\cdot0.33925\right)=\$69.46/month

$$

Approximate annual cloud range from this model: `$317 - $833`.

## Fit for Project

### Pros

- Strong local throughput for routine indexing and synthesis.
- Low cloud dependence during normal operation.
- Better concurrency margin for team SSH usage.

### Constraints

- Higher capital cost than entry option.
- Still has cloud spillover during sustained peak months.

## Recommended If

Choose this if you want the best balance for a multi-semester research node without stepping into high-end server cost territory.
